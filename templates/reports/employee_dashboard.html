{% extends 'base.html' %}

{% block title %}Employee Dashboard - EOD Report System{% endblock %}

{% block content %}
<div class="page-header">
    <h2><i class="bi bi-house-door-fill"></i> Employee Dashboard</h2>
    <p class="subtitle">Welcome back, <strong>{{ user.get_full_name }}</strong>! Here's your weekly overview.</p>
</div>

{% if is_weekend %}
<div class="alert alert-info fade-in" role="alert">
    <i class="bi bi-calendar-week"></i> <strong>Weekend Mode:</strong> Enjoy your weekend! The new work week starts on Monday ({{ week_start|date:"M d, Y" }}).
</div>
{% endif %}

<!-- Current Week Section -->
<div class="card week-card mb-4 fade-in">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0"><i class="bi bi-calendar-week"></i> Current Week Performance</h5>
        <span class="badge bg-white text-dark">{{ week_display }}</span>
    </div>
    <div class="week-stats">
        <div class="week-stat-item">
            <span class="week-stat-number">{{ week_total }}</span>
            <span class="week-stat-label">Total Reports</span>
        </div>
        <div class="week-stat-item">
            <span class="week-stat-number">{{ week_pending }}</span>
            <span class="week-stat-label">Pending</span>
        </div>
        <div class="week-stat-item">
            <span class="week-stat-number">{{ week_approved }}</span>
            <span class="week-stat-label">Approved</span>
        </div>
        <div class="week-stat-item">
            <span class="week-stat-number">{{ week_rejected }}</span>
            <span class="week-stat-label">Rejected</span>
        </div>
    </div>
</div>

<!-- Quick Action -->
<div class="row mb-4 fade-in">
    <div class="col">
        <div class="card quick-action-card">
            <div class="card-body text-center">
                {% if is_weekend %}
                <h5><i class="bi bi-calendar-week text-info"></i> It's the Weekend!</h5>
                <p class="text-muted">{{ today }}</p>
                <p class="text-info">You can submit reports for any weekday (Monday-Friday) that you may have missed.</p>
                <a href="{% url 'reports:submit_report' %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Submit Report for a Weekday
                </a>
                <p class="text-muted mt-2"><small>Note: Reports can only be for weekday dates (Mon-Fri), not weekend dates.</small></p>
                {% else %}
                    {% if today_report_exists %}
                    <h5><i class="bi bi-check-circle text-success"></i> You've submitted your report for today!</h5>
                    <p class="text-muted">{{ today }}</p>
                    {% if can_edit_today_report %}
                    <a href="{% url 'reports:submit_report' %}" class="btn btn-outline-primary">
                        <i class="bi bi-pencil"></i> Edit Today's Report
                    </a>
                    <p class="text-muted mt-2"><small>Status: <span class="badge bg-warning">{{ today_report.get_status_display }}</span></small></p>
                    {% else %}
                    <p class="text-info"><i class="bi bi-lock"></i> Report has been {{ today_report.get_status_display|lower }} and cannot be edited</p>
                    <p class="text-muted"><small>Status:
                        {% if today_report.status == 'APPROVED' %}
                        <span class="badge bg-success">{{ today_report.get_status_display }}</span>
                        {% else %}
                        <span class="badge bg-danger">{{ today_report.get_status_display }}</span>
                        {% endif %}
                    </small></p>
                    {% endif %}
                    {% else %}
                    <h5><i class="bi bi-exclamation-circle text-warning"></i> You haven't submitted a report for today</h5>
                    <p class="text-muted">{{ today }}</p>
                    <a href="{% url 'reports:submit_report' %}" class="btn btn-primary btn-lg">
                        <i class="bi bi-plus-circle"></i> Submit EOD Report
                    </a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Reports -->
<div class="row fade-in">
    <div class="col">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-journal-text"></i> Recent Activity</h5>
                <a href="{% url 'reports:my_reports' %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-arrow-right-circle"></i> View All
                </a>
            </div>
            <div class="card-body">
                {% if reports %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th><i class="bi bi-calendar3"></i> Date</th>
                                <th><i class="bi bi-briefcase"></i> Project</th>
                                <th><i class="bi bi-clock"></i> Hours</th>
                                <th><i class="bi bi-check-circle"></i> Status</th>
                                <th><i class="bi bi-eye"></i> Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports %}
                            <tr>
                                <td><strong>{{ report.report_date|date:"M d, Y" }}</strong></td>
                                <td><span class="text-muted">{{ report.project_name }}</span></td>
                                <td>
                                    <span class="badge bg-light text-dark">
                                        <i class="bi bi-clock-history"></i> {{ report.hours_worked }} hrs
                                    </span>
                                </td>
                                <td>
                                    {% if report.status == 'PENDING' %}
                                    <span class="badge status-pending">
                                        <span class="status-icon pending"></span>Pending
                                    </span>
                                    {% elif report.status == 'APPROVED' %}
                                    <span class="badge status-approved">
                                        <span class="status-icon approved"></span>Approved
                                    </span>
                                    {% else %}
                                    <span class="badge status-rejected">
                                        <span class="status-icon rejected"></span>Rejected
                                    </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'reports:report_detail' report.pk %}"
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye-fill"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <h5>No Reports Yet</h5>
                    <p>Start by submitting your first EOD report!</p>
                    <a href="{% url 'reports:submit_report' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Submit Your First Report
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
